@model IEnumerable<CompanyAPP.Models.Employee>

@{
    ViewData["Title"] = "員工管理";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1> 員工管理</h1>
        <a asp-action="Create" class="btn btn-primary btn-lg">
            + 新增員工
        </a>
    </div>

    @* 搜尋框，JS 控制 *@
    <div class="input-group mb-4 shadow-sm">
        <span class="input-group-text bg-white border-end-0">🔍</span>

@*         id="searchInput" 是給 JS 抓的重點
        oninput="searchEmployees()" 代表打字就觸發 *@
        <input type="text" id="searchInput" class="form-control border-start-0"
               placeholder="請輸入姓名、職位或 Email (即時搜尋)..."
               oninput="searchEmployees()">
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0" id="tableContainer">
            @* 剛進來時，先載入預設的表格 *@
            <partial name="_EmployeeTable" model="Model" />
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // 防止使用者打字太快，防抖動(Debounce)機制
        let timeout = null;

        function searchEmployees() {

            let keyword = document.getElementById("searchInput").value;
            clearTimeout(timeout);
            timeout = setTimeout(function () {

                let url = `/Employees/Filter?searchString=${keyword}`;

                $("#tableContainer").load(url, function(response, status, xhr) {
                    if (status == "error") {
                        console.log("搜尋失敗: " + xhr.status + " " + xhr.statusText);
                    }
                });

            }, 300);
        }
    </script>
}