@model IEnumerable<CompanyAPP.Models.AuditLog>

@{
    ViewData["Title"] = "系統軌跡紀錄";
}

<div class="container mt-4">
    <h2 class="mb-3">系統操作軌跡 (最近 50 筆)</h2>

    <div class="card shadow">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-striped align-middle mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th width="15%">時間 (UTC)</th>
                            <th width="15%">操作者</th>
                            <th width="10%">動作</th>
                            <th width="10%">資料表</th>
                            <th>變更內容 (JSON)</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var log in Model)
                        {
                            <tr>
                                <td class="small">@log.Timestamp.ToLocalTime().ToString("yyyy/MM/dd HH:mm:ss")</td>
                                <td>
                                    <span class="fw-bold">@log.UserName</span>
                                    <br />
                                    <small class="text-muted" style="font-size: 0.7em;">@log.UserId</small>
                                </td>
                                <td>
                                    @if (log.Action == "Added")
                                    {
                                        <span class="badge bg-success">新增</span>
                                    }
                                    else if (log.Action == "Modified")
                                    {

                                        <span class="badge bg-warning text-dark">修改</span>
                                    }
                                    else if (log.Action == "Deleted")
                                    {

                                        <span class="badge bg-danger">刪除</span>
                                    }
                                </td>
                                <td>@log.EntityName</td>
                                <td class="text-break" style="font-family: monospace; font-size: 0.85em;">
                                    <div><strong>Key:</strong> @log.KeyValues</div>
                                    @if (!string.IsNullOrEmpty(log.Changes))
                                    {
                                        <div class="mt-1 text-primary"><strong>Diff:</strong> @log.Changes</div>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>